



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://samaritan-proxy.github.io/start/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Getting Started - Samaritan Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-150917439-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="black" data-md-color-accent="black">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="500" height="500" viewBox="0 0 500 500" id="__gitlab"><path fill="currentColor" d="M93.667 473.347l90.684-279.097H2.983l90.684 279.097z" transform="translate(156.198 1.16)"/><path fill="currentColor" d="M221.333 473.345L130.649 194.25H3.557l217.776 279.095z" transform="translate(28.531 1.16)" opacity=".7"/><path fill="currentColor" d="M32 195.155L4.441 279.97a18.773 18.773 0 0 0 6.821 20.99l238.514 173.29L32 195.155z" transform="translate(.089 .256)" opacity=".5"/><path fill="currentColor" d="M2.667-84.844h127.092L75.14-252.942c-2.811-8.649-15.047-8.649-17.856 0L2.667-84.844z" transform="translate(29.422 280.256)"/><path fill="currentColor" d="M2.667 473.345L93.351 194.25h127.092L2.667 473.345z" transform="translate(247.198 1.16)" opacity=".7"/><path fill="currentColor" d="M221.334 195.155l27.559 84.815a18.772 18.772 0 0 1-6.821 20.99L3.557 474.25l217.777-279.095z" transform="translate(246.307 .256)" opacity=".5"/><path fill="currentColor" d="M130.667-84.844H3.575l54.618-168.098c2.811-8.649 15.047-8.649 17.856 0l54.618 168.098z" transform="translate(336.974 280.256)"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#getting-started" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://samaritan-proxy.github.io" title="Samaritan Documentation" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Samaritan Documentation
            </span>
            <span class="md-header-nav__topic">
              
                Getting Started
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="http://gitlab.alibaba-inc.com/eleme-infra/samaritan" title="Go to repository" class="md-source" data-md-source="gitlab">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    eleme-infra/samaritan
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://samaritan-proxy.github.io" title="Samaritan Documentation" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Samaritan Documentation
  </label>
  
    <div class="md-nav__source">
      


  

<a href="http://gitlab.alibaba-inc.com/eleme-infra/samaritan" title="Go to repository" class="md-source" data-md-source="gitlab">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__gitlab" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    eleme-infra/samaritan
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Getting Started
      </label>
    
    <a href="./" title="Getting Started" class="md-nav__link md-nav__link--active">
      Getting Started
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-built-binaries" class="md-nav__link">
    Pre-built binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manually-build" class="md-nav__link">
    Manually build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-simple-example" class="md-nav__link">
    Running simple example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instance" class="md-nav__link">
    instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log" class="md-nav__link">
    log
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stats" class="md-nav__link">
    stats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    admin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-services" class="md-nav__link">
    static services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-source" class="md-nav__link">
    dynamic source
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../arch/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../arch/admin-api/" title="Admin API" class="md-nav__link">
      Admin API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../arch/stats/" title="Stats" class="md-nav__link">
      Stats
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4">
    
    <label class="md-nav__link" for="nav-3-4">
      Protocol
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Protocol
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../arch/protocol/tcp/" title="TCP" class="md-nav__link">
      TCP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4-2" type="checkbox" id="nav-3-4-2">
    
    <label class="md-nav__link" for="nav-3-4-2">
      Redis
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="3">
      <label class="md-nav__title" for="nav-3-4-2">
        Redis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../arch/protocol/redis/redis/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../changelog/" title="Changelog" class="md-nav__link">
      Changelog
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../proto-ref/" title="Proto Reference" class="md-nav__link">
      Proto Reference
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" title="FAQ" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pre-built-binaries" class="md-nav__link">
    Pre-built binaries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manually-build" class="md-nav__link">
    Manually build
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-simple-example" class="md-nav__link">
    Running simple example
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instance" class="md-nav__link">
    instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#log" class="md-nav__link">
    log
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stats" class="md-nav__link">
    stats
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#admin" class="md-nav__link">
    admin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-services" class="md-nav__link">
    static services
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dynamic-source" class="md-nav__link">
    dynamic source
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<p>This section describes how to get started quickly and provides some sample configurations.</p>
<h2 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h2>
<h3 id="pre-built-binaries">Pre-built binaries<a class="headerlink" href="#pre-built-binaries" title="Permanent link">&para;</a></h3>
<p>It's the fastest way, you can choose the appropriate binaries from <a href="https://github.com/samaritan-proxy/samaritan/releases">release page</a>.</p>
<p>Assuming your os system is darwin and platform is amd64, you can use the following command to download and install.</p>
<div class="codehilite"><pre><span></span>$ <span class="nv">VERSION</span><span class="o">=</span><span class="m">1</span>.0.0 <span class="nv">OS</span><span class="o">=</span>darwin <span class="nv">ARCH</span><span class="o">=</span>amd64 curl -fsSL <span class="se">\</span>
    https://github.com/samaritan-proxy/samaritan/releases/download/v<span class="nv">$VERSION</span>/samaritan-<span class="nv">$OS</span>-<span class="nv">$ARCH</span>.tar.gz <span class="se">\</span>
    -o /tmp/samaritan-<span class="nv">$VERSION</span>.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    tar -zxvf /tmp/samaritan-<span class="nv">$VERSION</span>.tar.gz <span class="o">&amp;&amp;</span> <span class="se">\</span>
    install /tmp/samaritan-<span class="nv">$VERSION</span>/samaritan /usr/local/bin
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You should replace the version, os system and arch information in download link as needed.</p>
</div>
<h3 id="manually-build">Manually build<a class="headerlink" href="#manually-build" title="Permanent link">&para;</a></h3>
<p>If the pre-built binaries doesn't meet your needs or want to try the lastest features which are not released, you could build
it from the source code. This first needs <em><a href="https://golang.org">Go</a></em> installed(version 1.13+ is required).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The master branch is in continuous development and has not undergone the extensive testing and verification. There may be
some unknown problems, please do not use it directly for production.</p>
</div>
<div class="codehilite"><pre><span></span>$ git clone https://github.com/samaritan-proxy/samaritan.git
$ <span class="nb">cd</span> samaritan <span class="o">&amp;&amp;</span> make
$ install ./bin/samaritan /usr/local/bin
</pre></div>


<h2 id="running-simple-example">Running simple example<a class="headerlink" href="#running-simple-example" title="Permanent link">&para;</a></h2>
<p>The following is an example of using Sam as a L4 layer TCP proxy to access <a href="http://example.com">example.com</a></p>
<p>Terminal 1</p>
<div class="codehilite"><pre><span></span>$ <span class="c1"># resolve example.com, get ip</span>
$ <span class="nv">ip</span><span class="o">=</span><span class="k">$(</span>dig +short example.com <span class="p">|</span> head -1<span class="k">)</span>
$ <span class="c1"># generate config file</span>
$ sudo bash -c <span class="s1">&#39;cat &gt; /etc/samaritan.yaml&#39;</span> <span class="s">&lt;&lt;EOF</span>
<span class="s">admin:</span>
<span class="s">  bind:</span>
<span class="s">    ip: 127.0.0.1</span>
<span class="s">    port: 12345</span>
<span class="s">log:</span>
<span class="s">  level: INFO</span>
<span class="s">static_services:</span>
<span class="s">  - name: exmaple.com</span>
<span class="s">    config:</span>
<span class="s">      listener:</span>
<span class="s">        address:</span>
<span class="s">          ip: 0.0.0.0</span>
<span class="s">          port: 8080</span>
<span class="s">      protocol: TCP</span>
<span class="s">    endpoints:</span>
<span class="s">      - address:</span>
<span class="s">          ip: $ip</span>
<span class="s">          port: 80</span>
<span class="s">EOF</span>
$ <span class="c1"># start samaritan</span>
$ samaritan
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.067913 samaritan.go:60: stats config is empty
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.068501 samaritan.go:184: Using CPUs: <span class="m">4</span>
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.068513 samaritan.go:185: Version: <span class="m">1</span>.0.0
D <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.068579 config.go:114: Disable dynamic config
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.070397 server.go:39: Starting HTTP server at <span class="m">0</span>.0.0.0:12345
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.070534 samaritan.go:89: PID: <span class="m">60289</span>
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.072735 monitor.go:48: health check config is null, healthy check will disable
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.074646 controller.go:110: Add processor exmaple
I <span class="m">2019</span>/10/18 <span class="m">15</span>:10:38.093603 listener.go:105: <span class="o">[</span>exmaple<span class="o">]</span> start serving at <span class="m">0</span>.0.0.0:8080
</pre></div>


<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You could store the config file anywhere you like and can find.</p>
</div>
<p>Terminal 2</p>
<div class="codehilite"><pre><span></span>$ curl -v -I -H <span class="s2">&quot;Host: example.com&quot;</span> http://127.0.0.1:8080
* Rebuilt URL to: http://127.0.0.1:8080/
*   Trying <span class="m">127</span>.0.0.1...
* TCP_NODELAY <span class="nb">set</span>
* Connected to <span class="m">127</span>.0.0.1 <span class="o">(</span><span class="m">127</span>.0.0.1<span class="o">)</span> port <span class="m">8080</span> <span class="o">(</span><span class="c1">#0)</span>
&gt; HEAD / HTTP/1.1
&gt; Host: example.com
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 <span class="m">200</span> OK
HTTP/1.1 <span class="m">200</span> OK
&lt; Accept-Ranges: bytes
Accept-Ranges: bytes
&lt; Cache-Control: max-age<span class="o">=</span><span class="m">604800</span>
Cache-Control: max-age<span class="o">=</span><span class="m">604800</span>
&lt; Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
&lt; Date: Fri, <span class="m">18</span> Oct <span class="m">2019</span> <span class="m">07</span>:26:11 GMT
Date: Fri, <span class="m">18</span> Oct <span class="m">2019</span> <span class="m">07</span>:26:11 GMT
&lt; Etag: <span class="s2">&quot;3147526947+gzip+ident&quot;</span>
Etag: <span class="s2">&quot;3147526947+gzip+ident&quot;</span>
&lt; Expires: Fri, <span class="m">25</span> Oct <span class="m">2019</span> <span class="m">07</span>:26:11 GMT
Expires: Fri, <span class="m">25</span> Oct <span class="m">2019</span> <span class="m">07</span>:26:11 GMT
&lt; Last-Modified: Thu, <span class="m">17</span> Oct <span class="m">2019</span> <span class="m">07</span>:18:26 GMT
Last-Modified: Thu, <span class="m">17</span> Oct <span class="m">2019</span> <span class="m">07</span>:18:26 GMT
&lt; Server: ECS <span class="o">(</span>sjc/4E74<span class="o">)</span>
Server: ECS <span class="o">(</span>sjc/4E74<span class="o">)</span>
&lt; X-Cache: HIT
X-Cache: HIT
&lt; Content-Length: <span class="m">1256</span>
Content-Length: <span class="m">1256</span>

&lt;
* Connection <span class="c1">#0 to host 127.0.0.1 left intact</span>
</pre></div>


<p>As you can see, we visited <a href="http://example.com">example.com</a> via Sam.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>In the aboved section, we generate a simple configuration file and start Sam with it. But you may have no idea about
it, you may be overwhelmed. For better understanding, we will show you the specific parts of the configuration file.</p>
<h3 id="instance">instance<a class="headerlink" href="#instance" title="Permanent link">&para;</a></h3>
<p>The <a href="../proto-ref/#instance">instance message</a> is used to specify the environment in which the instance is located, and will be reported to
the management server.</p>
<div class="codehilite"><pre><span></span><span class="nt">instance</span><span class="p">:</span>
  <span class="nt">id</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ip_port</span>
  <span class="nt">belong</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">sash</span>
</pre></div>


<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you want to use the dynamic config feature, you must add this section to configuration file.</p>
</div>
<h3 id="log">log<a class="headerlink" href="#log" title="Permanent link">&para;</a></h3>
<p>The <a href="../proto-ref/#log">log message</a> is used to specify the log level and output destination.</p>
<div class="codehilite"><pre><span></span><span class="nt">log</span><span class="p">:</span>
  <span class="nt">level</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">INFO</span>
  <span class="nt">output</span><span class="p">:</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SYSLOG</span>
    <span class="nt">target</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.1:514</span>
</pre></div>


<p>If it is omitted, the log level will be <em>INFO</em> and the message will be printed to terminal.</p>
<div class="admonition question">
<p class="admonition-title">Why does the output not support files</p>
<ul>
<li>If the disk io hang, the whole process will probably hang when not handled correctly, we don't want this to happen.</li>
<li>There are a lot mature toolkit to process logs in linux system, such as ryslog and logrotate.
  We should reuse them instead of creating ourselves.</li>
</ul>
</div>
<h3 id="stats">stats<a class="headerlink" href="#stats" title="Permanent link">&para;</a></h3>
<p>The <a href="../proto-ref/#stats">stats message</a> is used to specify the stats config include internal metrics config and sinks.</p>
<div class="codehilite"><pre><span></span><span class="nt">stats</span><span class="p">:</span>
  <span class="nt">sinks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">STATSD</span>
      <span class="nt">endpoint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com:8125</span>
</pre></div>


<p>If it is omitted, the internal metrics wouldn't flush to any <em>TSDB</em> except <a href="https://prometheus.io">Prometheus</a> which could still be visited via <code>/amin/stats/prometheus</code>.
<a href="https://prometheus.io">Prometheus</a> is sufficient for most users which means you could omit the stats config directly.</p>
<h3 id="admin">admin<a class="headerlink" href="#admin" title="Permanent link">&para;</a></h3>
<p>The <a href="../proto-ref/#admin">admin message</a> is used to specify the configuration for local admin api.</p>
<div class="codehilite"><pre><span></span><span class="nt">admin</span><span class="p">:</span>
  <span class="nt">bind</span><span class="p">:</span>
    <span class="nt">ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
    <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">12345</span>
</pre></div>


<p>It's required, otherwise the entire process cannot be started. More details about admin api, you can view <a href="">doc</a></p>
<h3 id="static-services">static services<a class="headerlink" href="#static-services" title="Permanent link">&para;</a></h3>
<p>The <a href="../proto-ref/#staticservice">static service message</a> is used to specify the static service including name, proxy strategy and endpoints.</p>
<div class="codehilite"><pre><span></span><span class="nt">static_services</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com</span>
    <span class="nt">config</span><span class="p">:</span>
      <span class="nt">listener</span><span class="p">:</span>
        <span class="nt">address</span><span class="p">:</span>
          <span class="nt">ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">127.0.0.1</span>
          <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8080</span>
      <span class=" -Error"> </span><span class="nt">protocol</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">TCP</span>
    <span class="nt">endpoints</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">address</span><span class="p">:</span>
          <span class="nt">ip</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">93.184.216.34</span>
          <span class="nt">port</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div>


<p>You can use it to configure the proxy's services in a local development environment, but it is not recommended.
Here are the reasons:</p>
<ol>
<li>Contains a lot configuraton items, easy to make mistakes when writing by hand.</li>
<li>Unable to support large-scale operation and maintenance, imagine how to update the configuration if deployed to a 10k machines. It's so horrible.</li>
</ol>
<p>The correct and recommended way is to use dynamic source, which will be described in detail below.</p>
<h3 id="dynamic-source">dynamic source<a class="headerlink" href="#dynamic-source" title="Permanent link">&para;</a></h3>
<p>The <a href="../proto-ref/#bootstrap.ConfigSource">dynamic source message</a> is used to specify the dynamic source configuration.</p>
<div class="codehilite"><pre><span></span><span class="nt">dynamic_source_config</span><span class="p">:</span>
  <span class="nt">endpoint</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">example.com:80</span>
</pre></div>


<p>Once the dynamic source is configured, Sam could know and apply the changes of instance's dependent services, service's proxy policy and service's endpoints in real time.
The communication way between them is grpc, and <a href="../proto-ref/#discoveryservice">here</a> is the specific interface definition.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As the management server, <strong>Sash</strong> will implement all the interface required by dynamic source.
It is still private now, but we will open source as soon as possible.</p>
</div>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permanent link">&para;</a></h2>
<p>TBD</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </span>
            </div>
          </a>
        
        
          <a href="../arch/overview/" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Overview
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Samaritan Developers
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
        <script src="https://unpkg.com/mermaid@7.1.0/dist/mermaid.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script>
      
        <script src="../js/umlconvert.js"></script>
      
    
  </body>
</html>